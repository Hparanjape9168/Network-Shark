package BackRun;

import java.io.*;
import java.sql.Connection;
import java.sql.DriverManager;
import java.util.Timer;
import java.util.TimerTask;
import connection.constants;
import java.rmi.RemoteException;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class pentest {
   static String date1, myip, host, act;
   static boolean flag = true;
   
   Runtime runtime = Runtime.getRuntime();
   public void my() throws RemoteException, ClassNotFoundException, SQLException, IOException 
   {
        Process proc = null;
        // constants connect = new constants();
        Connection con=null;
        
        String[] letters = new String[]{"A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L"};
        File[] drives = new File[letters.length];
        boolean[] isDrive = new boolean[letters.length];
        int totFiles = 0, totDirs = 0;

// init the file objects and the initial drive state
        for (int i = 0; i < letters.length; ++i) {
            drives[i] = new File(letters[i] + ":/");
            isDrive[i] = drives[i].canRead();
        }

        System.out.println("FindDrive: waiting for devices…");

        while (true) {

// check each drive
            for (int i = 0; i < letters.length; ++i) {
                boolean pluggedIn = drives[i].canRead();

// if the state has changed output a message
                if (pluggedIn != isDrive[i])
                {
                    flag = false;
                    System.out.println("pen drive detect1" + letters[i]);
                    if (pluggedIn) {

                        String path = letters[i] + "://";
                        File files = new File(path);
                        String allFiles[] = files.list();

                        for (int k = 0; k < allFiles.length; k++) {
                            File f = new File(path + "/" + allFiles[k]);
                            if (f.isDirectory()) {
                                totDirs++;
                                System.out.println("Directory :" + allFiles[k]);
                            } else {
                                totFiles++;
                                System.out.println("File :" + allFiles[k]);
                            }
                        }
                        System.out.println("Total Directories and Files :" + allFiles.length);
                        System.out.println("Total Directories :" + allFiles.length);
                        System.out.println("Total Files :" + allFiles.length);
                        new BackRun.penjoptionpane();
                        try{
                         illegal_access obj = new illegal_access();
                         String date1 = obj.send_date();
                         String myip = obj.ip_address();
                         String host = obj.hostname();
        
        
       
        Class.forName("com.mysql.jdbc.Driver");
        con = DriverManager.getConnection(connection.constants.url,connection.constants.userName,connection.constants.Password);
        String query = "insert into pendrive(ipaddress,hostname,date) value(?,?,?);";
                        PreparedStatement insert = con.prepareStatement(query);
                        
                        insert.setString(1, myip);
                        insert.setString(2, host);
                        //insert.setString(3, str);
                        insert.setString(3, date1);

                        int rs1 = insert.executeUpdate();
                        //System.out.println("affected rows:" + rs1);
                        System.out.println("Data inserted successfully");
        
            
                        }
                        catch(Exception ex)
                        {
                            ex.printStackTrace();
                        }
                       /* try {
                            proc = runtime.exec("RUNDLL32 shell32.dll,Control_RunDLL hotplug.dll -l");
                        } catch (Exception ex) {
                            ex.printStackTrace();
                        }*/
                    } else {
                        System.out.println("Drive " + letters[i] + " has been unplugged");
                    }

                    isDrive[i] = pluggedIn;
                }
                
            }
            
        }
   }
//    public void my1() throws RemoteException, ClassNotFoundException, SQLException, IOException 
//    {
//      Process proc = null;
//         constants connect = new constants();
//        Connection con=null;
//        
//        String[] letters = new String[]{"A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L"};
//        File[] drives = new File[letters.length];
//        boolean[] isDrive = new boolean[letters.length];
//        int totFiles = 0, totDirs = 0;
//
//// init the file objects and the initial drive state
//        for (int i = 0; i < letters.length; ++i) {
//            drives[i] = new File(letters[i] + ":/");
//            isDrive[i] = drives[i].canRead();
//        }
//
//        System.out.println("FindDrive: waiting for devices…");
//
//        while (true) {
//
//// check each drive
//            for (int i = 0; i < letters.length; ++i) {
//                boolean pluggedIn = drives[i].canRead();
//
//// if the state has changed output a message
//                if (pluggedIn != isDrive[i]) {
//                    System.out.println("pen drive detect1" + letters[i]);
//                    if (pluggedIn) {
//
//                        String path = letters[i] + "://";
//                        File files = new File(path);
//                        String allFiles[] = files.list();
//
//                        for (int k = 0; k < allFiles.length; k++) {
//                            File f = new File(path + "/" + allFiles[k]);
//                            if (f.isDirectory()) {
//                                totDirs++;
//                                System.out.println("Directory :" + allFiles[k]);
//                            } else {
//                                totFiles++;
//                                System.out.println("File :" + allFiles[k]);
//                            }
//                        }
//                        System.out.println("Total Directories and Files :" + allFiles.length);
//                        System.out.println("Total Directories :" + allFiles.length);
//                        System.out.println("Total Files :" + allFiles.length);
//                        //new Project.penjoptionpane();
//                        try{
//                         BackRun.illegal_access obj = new BackRun.illegal_access();
//                         String date1 = obj.send_date();
//                         String myip = obj.ip_address();
//                         String host = obj.hostname();
//                        }
//                        catch(Exception ex)
//                        {
//                            ex.printStackTrace();
//                        }
//    }
//                }
//            }
//        }
//    }
   
  
   public static void main(String[] args) {
        final pentest obj1 = new pentest();
        Timer myTimer = new Timer();
        TimerTask mytask = new TimerTask() {

            @Override
            public void run() {
                try {
                    obj1.my();
                    System.out.println("Runafter 5 seconds---->");
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
        };
        myTimer.schedule(mytask, 6000, 6000);

        try {
            Thread.sleep(5000);
        } catch (InterruptedException exc) {
            exc.printStackTrace();
        }
    }

  
}
